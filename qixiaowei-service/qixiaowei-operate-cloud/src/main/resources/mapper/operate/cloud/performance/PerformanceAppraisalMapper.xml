<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.qixiaowei.operate.cloud.mapper.performance.PerformanceAppraisalMapper">
    <!--    查询绩效考核表-->
    <select id="selectPerformanceAppraisalByPerformanceAppraisalId"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceAppraisalDTO">
        SELECT
        performance_appraisal_id, performance_rank_id, performance_rank_name, appraisal_year, appraisal_name,
        cycle_flag, cycle_type, cycle_number, appraisal_start_date, appraisal_end_date, filing_date, appraisal_flow,
        appraisal_object, self_defined_columns_flag, appraisal_status, delete_flag, create_by, create_time, update_by,
        update_time
        FROM performance_appraisal
        WHERE performance_appraisal_id=#{performanceAppraisalId}
        and delete_flag=0
    </select>

    <!--    批量查询绩效考核表-->
    <select id="selectPerformanceAppraisalByPerformanceAppraisalIds"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceAppraisalDTO">
        SELECT
        performance_appraisal_id, performance_rank_id, performance_rank_name, appraisal_year, appraisal_name,
        cycle_flag, cycle_type, cycle_number, appraisal_start_date, appraisal_end_date, filing_date, appraisal_flow,
        appraisal_object, self_defined_columns_flag, appraisal_status, delete_flag, create_by, create_time, update_by,
        update_time
        FROM performance_appraisal
        WHERE performance_appraisal_id in
        <foreach item="item"
                 collection="performanceAppraisalIds"
                 index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
        and delete_flag=0
    </select>

    <!--    查询绩效考核表列表-->
    <select id="selectPerformanceAppraisalList"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceAppraisalDTO">
        SELECT
        pa.performance_appraisal_id,
        pa.performance_rank_id,
        pa.performance_rank_name,
        pa.appraisal_year,
        pa.appraisal_name,
        pa.cycle_flag,
        pa.cycle_type,
        pa.cycle_number,
        pa.appraisal_start_date,
        pa.appraisal_end_date,
        pa.filing_date,
        pa.appraisal_flow,
        pa.appraisal_object,
        pa.self_defined_columns_flag,
        pa.appraisal_status,
        pa.delete_flag,
        pa.create_by,
        pa.create_time,
        pa.update_by,
        pa.update_time
        FROM performance_appraisal pa
        LEFT JOIN performance_rank pr
        ON pa.performance_rank_id = pr.performance_rank_id
        AND pr.delete_flag=0
        LEFT JOIN performance_appraisal_objects pao
        ON pa.performance_appraisal_id = pao.performance_appraisal_id
        AND pao.delete_flag = 0
        WHERE pa.delete_flag=0
        <if test="performanceAppraisal.performanceAppraisalId != null">
            and pa.performance_appraisal_id=#{performanceAppraisal.performanceAppraisalId}
        </if>
        <if test="performanceAppraisal.performanceRankId != null">
            and pa.performance_rank_id=#{performanceAppraisal.performanceRankId}
        </if>
        <if test="performanceAppraisal.performanceRankName != null and performanceAppraisal.performanceRankName != ''">
            and pa.performance_rank_name like concat('%', #{performanceAppraisal.performanceRankName}, '%')
        </if>
        <if test="performanceAppraisal.appraisalYear != null">
            and pa.appraisal_year=#{performanceAppraisal.appraisalYear}
        </if>
        <if test="performanceAppraisal.appraisalName != null and performanceAppraisal.appraisalName != ''">
            and pa.appraisal_name like concat('%', #{performanceAppraisal.appraisalName}, '%')
        </if>
        <if test="performanceAppraisal.cycleFlag != null">
            and pa.cycle_flag=#{performanceAppraisal.cycleFlag}
        </if>
        <if test="performanceAppraisal.cycleType != null">
            and pa.cycle_type=#{performanceAppraisal.cycleType}
        </if>
        <if test="performanceAppraisal.cycleNumber != null">
            and pa.cycle_number=#{performanceAppraisal.cycleNumber}
        </if>
        <if test="performanceAppraisal.appraisalFlow != null">
            and pa.appraisal_flow=#{performanceAppraisal.appraisalFlow}
        </if>
        <if test="performanceAppraisal.appraisalObject != null">
            and pa.appraisal_object=#{performanceAppraisal.appraisalObject}
        </if>
        <if test="performanceAppraisal.selfDefinedColumnsFlag != null">
            and pa.self_defined_columns_flag=#{performanceAppraisal.selfDefinedColumnsFlag}
        </if>
        <if test="performanceAppraisal.appraisalStatus != null">
            and pa.appraisal_status=#{performanceAppraisal.appraisalStatus}
        </if>
        <if test="performanceAppraisal.deleteFlag != null">
            and pa.delete_flag=#{performanceAppraisal.deleteFlag}
        </if>
        <if test="performanceAppraisal.createBy != null">
            and pa.create_by=#{performanceAppraisal.createBy}
        </if>
        <if test="performanceAppraisal.createTime != null">
            and pa.create_time=#{performanceAppraisal.createTime}
        </if>
        <if test="performanceAppraisal.updateBy != null">
            and pa.update_by=#{performanceAppraisal.updateBy}
        </if>
        <if test="performanceAppraisal.updateTime != null">
            and pa.update_time=#{performanceAppraisal.updateTime}
        </if>
        <!--    考核任务名称过滤-->
        <if test="performanceAppraisal.params.appraisalNameEqual != null and performanceAppraisal.params.appraisalNameEqual.size() > 0">
            AND pa.appraisal_name IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalNameEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.appraisalNameNotEqual != null and performanceAppraisal.params.appraisalNameNotEqual.size() > 0">
            AND (pa.appraisal_name NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalNameNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.appraisal_name IS NULL
            )
        </if>
        <if test="performanceAppraisal.params.performanceRankNameLike != null and performanceAppraisal.params.performanceRankNameLike.size() > 0">
            AND
            <foreach item="item"
                     collection="performanceAppraisal.params.performanceRankNameLike"
                     index="index" open="(" separator="OR" close=")">
                pa.performance_rank_name LIKE concat('%', #{item}, '%')
            </foreach>
        </if>
        <if test="performanceAppraisal.params.performanceRankNameNotLike != null and performanceAppraisal.params.performanceRankNameNotLike.size() > 0">
            AND
            <foreach item="item"
                     collection="performanceAppraisal.params.performanceRankNameNotLike"
                     index="index" open="(" separator="OR" close=")">
                pa.performance_rank_name NOT LIKE concat('%', #{item}, '%')
            </foreach>
        </if>
        <!--    考核年度过滤-->
        <if test="performanceAppraisal.params.appraisalYearEqual != null and performanceAppraisal.params.appraisalYearEqual.size() > 0">
            AND pa.appraisal_year IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalYearEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.appraisalYearNotEqual != null and performanceAppraisal.params.appraisalYearNotEqual.size() > 0">
            AND (pa.appraisal_year NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalYearNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.appraisal_year IS NULL
            )
        </if>
        <if test="performanceAppraisal.params.appraisalYearBefore != null and performanceAppraisal.params.appraisalYearBefore != ''">
            AND pa.appraisal_year &lt; #{performanceAppraisal.params.appraisalYearBefore}
        </if>
        <if test="performanceAppraisal.params.appraisalYearNotBefore != null and performanceAppraisal.params.appraisalYearNotBefore != ''">
            AND pa.appraisal_year &gt;= #{performanceAppraisal.params.appraisalYearNotBefore}
        </if>
        <if test="performanceAppraisal.params.appraisalYearAfter != null and performanceAppraisal.params.appraisalYearAfter != ''">
            AND pa.appraisal_year &gt; #{performanceAppraisal.params.appraisalYearAfter}
        </if>
        <if test="performanceAppraisal.params.appraisalYearNotAfter != null and performanceAppraisal.params.appraisalYearNotAfter != ''">
            AND pa.appraisal_year &lt;= #{performanceAppraisal.params.appraisalYearNotAfter}
        </if>
        <if test="performanceAppraisal.params.appraisalYearStart != null and performanceAppraisal.params.appraisalYearStart != ''">
            AND pa.appraisal_year &gt;= #{performanceAppraisal.params.appraisalYearStart}
        </if>
        <if test="performanceAppraisal.params.appraisalYearEnd != null and performanceAppraisal.params.appraisalYearEnd != ''">
            AND pa.appraisal_year &lt;= #{performanceAppraisal.params.appraisalYearEnd}
        </if>
        <!--    周期类型-->
        <if test="performanceAppraisal.params.cycleTypeEqual != null and performanceAppraisal.params.cycleTypeEqual.size() > 0">
            AND pa.cycle_type IN
            <foreach item="item"
                     collection="performanceAppraisal.params.cycleTypeEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.cycleTypeNotEqual != null and performanceAppraisal.params.cycleTypeNotEqual.size() > 0">
            AND (pa.cycle_type NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.cycleTypeNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.cycle_type IS NULL
            )
        </if>
        <!--    是否周期性考核-->
        <if test="performanceAppraisal.params.cycleFlagEqual != null and performanceAppraisal.params.cycleFlagEqual.size() > 0">
            AND pa.cycle_flag IN
            <foreach item="item"
                     collection="performanceAppraisal.params.cycleFlagEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.cycleFlagNotEqual != null and performanceAppraisal.params.cycleFlagNotEqual.size() > 0">
            AND (pa.cycle_flag NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.cycleFlagNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.cycle_flag IS NULL
            )
        </if>
        <!--    考核周期-->
        <if test="performanceAppraisal.params.cycleNumberEqual != null and performanceAppraisal.params.cycleNumberEqual.size() > 0">
            AND pa.cycle_number IN
            <foreach item="item"
                     collection="performanceAppraisal.params.cycleNumberEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.cycleNumberNotEqual != null and performanceAppraisal.params.cycleNumberNotEqual.size() > 0">
            AND (pa.cycle_number NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.cycleNumberNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.cycle_number IS NULL
            )
        </if>
        <!--    考核开始日期-->
        <if test="performanceAppraisal.params.appraisalStartDateEqual != null and performanceAppraisal.params.appraisalStartDateEqual.size() > 0">
            AND pa.appraisal_start_date IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalStartDateEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.appraisalStartDateNotEqual != null and performanceAppraisal.params.appraisalStartDateNotEqual.size() > 0">
            AND (pa.appraisal_start_date NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalStartDateNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.appraisal_start_date IS NULL
            )
        </if>
        <if test="performanceAppraisal.params.appraisalStartDateBefore != null and performanceAppraisal.params.appraisalStartDateBefore != ''">
            AND date_format(pa.appraisal_start_date,'%y%m%d') &lt;
            date_format(#{performanceAppraisal.params.appraisalStartDateBefore},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalStartDateNotBefore != null and performanceAppraisal.params.appraisalStartDateNotBefore != ''">
            AND date_format(pa.appraisal_start_date,'%y%m%d') &gt;=
            date_format(#{performanceAppraisal.params.appraisalStartDateNotBefore},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalStartDateAfter != null and performanceAppraisal.params.appraisalStartDateAfter != ''">
            AND date_format(pa.appraisal_start_date,'%y%m%d') &gt;
            date_format(#{performanceAppraisal.params.appraisalStartDateAfter},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalStartDateNotAfter != null and performanceAppraisal.params.appraisalStartDateNotAfter != ''">
            AND date_format(pa.appraisal_start_date,'%y%m%d') &lt;=
            date_format(#{performanceAppraisal.params.appraisalStartDateNotAfter},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalStartDateStart != null and performanceAppraisal.params.appraisalStartDateStart != ''">
            AND date_format(pa.appraisal_start_date,'%y%m%d') &gt;=
            date_format(#{performanceAppraisal.params.appraisalStartDateStart},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalStartDateEnd != null and performanceAppraisal.params.appraisalStartDateEnd != ''">
            AND date_format(pa.appraisal_start_date,'%y%m%d') &lt;=
            date_format(#{performanceAppraisal.params.appraisalStartDateEnd},'%y%m%d')
        </if>
        <!--    考核结束日期-->
        <if test="performanceAppraisal.params.appraisalEndDateEqual != null and performanceAppraisal.params.appraisalEndDateEqual.size() > 0">
            AND pa.appraisal_end_date IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalEndDateEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.appraisalEndDateNotEqual != null and performanceAppraisal.params.appraisalEndDateNotEqual.size() > 0">
            AND (pa.appraisal_end_date NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalEndDateNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.appraisal_end_date IS NULL
            )
        </if>
        <if test="performanceAppraisal.params.appraisalEndDateBefore != null and performanceAppraisal.params.appraisalEndDateBefore != ''">
            AND date_format(pa.appraisal_end_date,'%y%m%d') &lt;
            date_format(#{performanceAppraisal.params.appraisalEndDateBefore},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalEndDateNotBefore != null and performanceAppraisal.params.appraisalEndDateNotBefore != ''">
            AND date_format(pa.appraisal_end_date,'%y%m%d') &gt;=
            date_format(#{performanceAppraisal.params.appraisalEndDateNotBefore},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalEndDateAfter != null and performanceAppraisal.params.appraisalEndDateAfter != ''">
            AND date_format(pa.appraisal_end_date,'%y%m%d') &gt;
            date_format(#{performanceAppraisal.params.appraisalEndDateAfter},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalEndDateNotAfter != null and performanceAppraisal.params.appraisalEndDateNotAfter != ''">
            AND date_format(pa.appraisal_end_date,'%y%m%d') &lt;=
            date_format(#{performanceAppraisal.params.appraisalEndDateNotAfter},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalEndDateStart != null and performanceAppraisal.params.appraisalEndDateStart != ''">
            AND date_format(pa.appraisal_end_date,'%y%m%d') &gt;=
            date_format(#{performanceAppraisal.params.appraisalEndDateStart},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.appraisalEndDateEnd != null and performanceAppraisal.params.appraisalEndDateEnd != ''">
            AND date_format(pa.appraisal_end_date,'%y%m%d') &lt;=
            date_format(#{performanceAppraisal.params.appraisalEndDateEnd},'%y%m%d')
        </if>
        <!--    归档日期过滤-->
        <if test="performanceAppraisal.params.filingDateEqual != null and performanceAppraisal.params.filingDateEqual.size() > 0">
            AND pa.filing_date IN
            <foreach item="item"
                     collection="performanceAppraisal.params.filingDateEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.filingDateNotEqual != null and performanceAppraisal.params.filingDateNotEqual.size() > 0">
            AND (pa.filing_date NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.filingDateNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.filing_date IS NULL
            )
        </if>
        <if test="performanceAppraisal.params.filingDateBefore != null and performanceAppraisal.params.filingDateBefore != ''">
            AND date_format(pa.filing_date,'%y%m%d') &lt;
            date_format(#{performanceAppraisal.params.filingDateBefore},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.filingDateNotBefore != null and performanceAppraisal.params.filingDateNotBefore != ''">
            AND date_format(pa.filing_date,'%y%m%d') &gt;=
            date_format(#{performanceAppraisal.params.filingDateNotBefore},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.filingDateAfter != null and performanceAppraisal.params.filingDateAfter != ''">
            AND date_format(pa.filing_date,'%y%m%d') &gt;
            date_format(#{performanceAppraisal.params.filingDateAfter},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.filingDateNotAfter != null and performanceAppraisal.params.filingDateNotAfter != ''">
            AND date_format(pa.filing_date,'%y%m%d') &lt;=
            date_format(#{performanceAppraisal.params.filingDateNotAfter},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.filingDateStart != null and performanceAppraisal.params.filingDateStart != ''">
            AND date_format(pa.filing_date,'%y%m%d') &gt;=
            date_format(#{performanceAppraisal.params.filingDateStart},'%y%m%d')
        </if>
        <if test="performanceAppraisal.params.filingDateEnd != null and performanceAppraisal.params.filingDateEnd != ''">
            AND date_format(pa.filing_date,'%y%m%d') &lt;=
            date_format(#{performanceAppraisal.params.filingDateEnd},'%y%m%d')
        </if>
        <!--    考核对象-->
        <if test="performanceAppraisal.params.appraisalObjectEqual != null and performanceAppraisal.params.appraisalObjectEqual.size() > 0">
            AND pa.appraisal_object IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalObjectEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.appraisalObjectNotEqual != null and performanceAppraisal.params.appraisalObjectNotEqual.size() > 0">
            AND (pa.appraisal_object NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalObjectNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.appraisal_object IS NULL
            )
        </if>
        <!--    绩效等级-->
        <if test="performanceAppraisal.params.performanceRankNameEqual != null and performanceAppraisal.params.performanceRankNameEqual.size() > 0">
            AND pr.performance_rank_name IN
            <foreach item="item"
                     collection="performanceAppraisal.params.performanceRankNameEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.performanceRankNameNotEqual != null and performanceAppraisal.params.performanceRankNameNotEqual.size() > 0">
            AND (pr.performance_rank_name NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.performanceRankNameNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pr.performance_rank_name IS NULL
            )
        </if>
        <!--    考核流程-->
        <if test="performanceAppraisal.params.appraisalFlowEqual != null and performanceAppraisal.params.appraisalFlowEqual.size() > 0">
            AND pa.appraisal_flow IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalFlowEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.appraisalFlowNotEqual != null and performanceAppraisal.params.appraisalFlowNotEqual.size() > 0">
            AND (pa.appraisal_flow NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalFlowNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.appraisal_flow IS NULL
            )
        </if>
        <!--    任务阶段-->
        <if test="performanceAppraisal.params.appraisalStatusEqual != null and performanceAppraisal.params.appraisalStatusEqual.size() > 0">
            AND pa.appraisal_status IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalStatusEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisal.params.appraisalStatusNotEqual != null and performanceAppraisal.params.appraisalStatusNotEqual.size() > 0">
            AND (pa.appraisal_status NOT IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalStatusNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pa.appraisal_status IS NULL
            )
        </if>
        <!--    组织高级搜索-->
        <if test="performanceAppraisal.params.departmentIds != null and performanceAppraisal.params.departmentIds.size() > 0">
            AND pa.appraisal_object = 1
            AND pao.appraisal_object_id IN
            <foreach item="item"
                     collection="performanceAppraisal.params.departmentIds"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <!--    员工高级搜索-->
        <if test="performanceAppraisal.params.employeeIds != null and performanceAppraisal.params.employeeIds.size() > 0">
            AND pa.appraisal_object = 2
            AND pao.appraisal_object_id IN
            <foreach item="item"
                     collection="performanceAppraisal.params.employeeIds"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        GROUP BY pa.performance_appraisal_id
        ORDER BY pa.appraisal_year,pa.cycle_number
    </select>
    <select id="selectRankFactorByAppraisalId"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceRankFactorDTO">
        SELECT
        pa.performance_appraisal_id,
        pa.self_defined_columns_flag,
        pf.performance_rank_factor_id,
        pf.performance_rank_id,
        pf.performance_rank_name,
        pf.bonus_factor,
        pf.sort,
        pf.delete_flag,
        pf.create_by,
        pf.create_time,
        pf.update_by,
        pf.update_time
        FROM performance_appraisal pa
        LEFT JOIN performance_rank_factor pf
        ON pf.performance_rank_id = pa.performance_rank_id
        AND pf.delete_flag = 0
        WHERE
        pf.delete_flag = 0
        AND pa.performance_appraisal_id = #{appraisalId}
        ORDER BY pf.sort ASC
    </select>
    <select id="selectPerformanceAppraisalListByName"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceAppraisalDTO">
        SELECT
        performance_appraisal_id, performance_rank_id, appraisal_year, appraisal_name, cycle_flag, cycle_type,
        cycle_number, appraisal_start_date, appraisal_end_date, filing_date, appraisal_flow, appraisal_object,
        self_defined_columns_flag, appraisal_status, delete_flag, create_by, create_time, update_by, update_time
        FROM performance_appraisal
        WHERE delete_flag=0
        AND appraisal_name = #{appraisalName}
    </select>
    <!--查询绩效考核表列表-组织-制定-->
    <select id="selectOrgAppraisalObjectList"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceAppraisalObjectsDTO">
        SELECT
        pao.perform_appraisal_objects_id,
        pao.performance_appraisal_id,
        pao.appraisal_object_id,
        pao.appraisal_principal_id,
        IFNULL( pao.evaluation_score, 0.00 ) AS evaluation_score,
        pao.appraisal_result_id,
        pao.sort,
        pao.appraisal_object_status,
        pao.appraisal_principal_name,
        pao.create_by,
        pao.create_time,
        pao.update_by,
        pao.update_time,
        pas.appraisal_object_name,
        pas.appraisal_object_code,
        pas.department_id,
        pas.department_name,
        pas.post_id,
        pas.post_name,
        pas.official_rank_system_id,
        pas.official_rank,
        pas.official_rank_name,
        pa.appraisal_name,
        pa.appraisal_year,
        pa.cycle_type,
        pa.cycle_number,
        pa.appraisal_status,
        pao.appraisal_principal_name
        FROM
        performance_appraisal_objects pao
        LEFT JOIN perform_appraisal_object_snap pas ON pao.perform_appraisal_objects_id =
        pas.perform_appraisal_objects_id
        AND pas.delete_flag = 0
        LEFT JOIN performance_appraisal pa ON pa.performance_appraisal_id = pao.performance_appraisal_id
        AND pa.delete_flag = 0
        WHERE pao.delete_flag = 0
        <if test="performanceAppraisalObjectsDTO.appraisalName!=null and ''!= performanceAppraisalObjectsDTO.appraisalName">
            and pa.appraisal_name like concat('%', #{performanceAppraisalObjectsDTO.appraisalName}, '%')
        </if>
        <if test="performanceAppraisalObjectsDTO.appraisalYear!=null">
            and pa.appraisal_year=#{performanceAppraisalObjectsDTO.appraisalYear}
        </if>
        <if test="performanceAppraisalObjectsDTO.cycleType!=null">
            and pa.cycle_type=#{performanceAppraisalObjectsDTO.cycleType}
        </if>
        <if test="performanceAppraisalObjectsDTO.cycleNumber!=null">
            and pa.cycle_number=#{performanceAppraisalObjectsDTO.cycleNumber}
        </if>
        <if test="performanceAppraisalObjectsDTO.appraisalObjectName!=null and ''!= performanceAppraisalObjectsDTO.appraisalObjectName">
            and pas.appraisal_object_name like concat('%', #{performanceAppraisalObjectsDTO.appraisalObjectName}, '%')
        </if>
        <if test="performanceAppraisalObjectsDTO.appraisalObjectCode!=null and ''!= performanceAppraisalObjectsDTO.appraisalObjectCode">
            and pas.appraisal_object_code like concat('%', #{performanceAppraisalObjectsDTO.appraisalObjectCode}, '%')
        </if>
        <if test="performanceAppraisalObjectsDTO.postName!=null and ''!= performanceAppraisalObjectsDTO.postName">
            and pas.post_name like concat('%', #{performanceAppraisalObjectsDTO.postName}, '%')
        </if>
        <if test="performanceAppraisalObjectsDTO.departmentName!=null and ''!= performanceAppraisalObjectsDTO.departmentName">
            and pas.department_name like concat('%', #{performanceAppraisalObjectsDTO.departmentName}, '%')
        </if>
        <if test="performanceAppraisalObjectsDTO.appraisalPrincipalName!=null and ''!= performanceAppraisalObjectsDTO.appraisalPrincipalName">
            and pao.appraisal_principal_name like concat('%', #{performanceAppraisalObjectsDTO.appraisalPrincipalName},
            '%')
        </if>
        <if test="performanceAppraisalObjectsDTO.appraisalObjectStatusList != null and performanceAppraisalObjectsDTO.appraisalObjectStatusList.size()>0">
            AND pao.appraisal_object_status IN
            <foreach collection="performanceAppraisalObjectsDTO.appraisalObjectStatusList" item="item" index="index"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisalObjectsDTO.performanceAppraisalIds != null and performanceAppraisalObjectsDTO.performanceAppraisalIds.size()>0">
            AND pao.performance_appraisal_id IN
            <foreach collection="performanceAppraisalObjectsDTO.performanceAppraisalIds" item="item" index="index"
                     separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <!--    状态过滤-->
        <if test="performanceAppraisalObjectsDTO.params.appraisalObjectStatusEqual != null and performanceAppraisalObjectsDTO.params.appraisalObjectStatusEqual.size() > 0">
            AND pao.appraisal_object_status IN
            <foreach item="item"
                     collection="performanceAppraisal.params.appraisalObjectStatusEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisalObjectsDTO.params.appraisalObjectStatusNotEqual != null and performanceAppraisalObjectsDTO.params.appraisalObjectStatusNotEqual.size() > 0">
            AND (pao.appraisal_object_status NOT IN
            <foreach item="item"
                     collection="performanceAppraisalObjectsDTO.params.appraisalObjectStatusNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pao.appraisal_object_status IS NULL
            )
        </if>
        <!--    评议分数过滤-->
        <if test="performanceAppraisalObjectsDTO.params.evaluationScoreEqual != null and performanceAppraisalObjectsDTO.params.evaluationScoreEqual.size() > 0">
            AND pao.evaluation_score IN
            <foreach item="item"
                     collection="performanceAppraisal.params.evaluationScoreEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="performanceAppraisalObjectsDTO.params.evaluationScoreNotEqual != null and performanceAppraisalObjectsDTO.params.evaluationScoreNotEqual.size() > 0">
            AND (pao.evaluation_score NOT IN
            <foreach item="item"
                     collection="performanceAppraisalObjectsDTO.params.evaluationScoreNotEqual"
                     index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
            OR pao.evaluation_score IS NULL
            )
        </if>
        <if test="performanceAppraisalObjectsDTO.params.evaluationScoreGreaterThan != null and performanceAppraisalObjectsDTO.params.evaluationScoreGreaterThan.size() > 0">
            AND
            <foreach item="item"
                     collection="performanceAppraisalObjectsDTO.params.evaluationScoreGreaterThan"
                     index="index" open="(" separator="OR" close=")">
                pao.evaluation_score &gt; #{item}
            </foreach>
        </if>
        <if test="performanceAppraisalObjectsDTO.params.evaluationScoreNotGreaterThan != null and performanceAppraisalObjectsDTO.params.evaluationScoreNotGreaterThan.size() > 0">
            AND
            <foreach item="item"
                     collection="performanceAppraisalObjectsDTO.params.evaluationScoreNotGreaterThan"
                     index="index" open="(" separator="OR" close=")">
                pao.evaluation_score &lt;= #{item}
            </foreach>
        </if>
        <if test="performanceAppraisalObjectsDTO.params.evaluationScoreLessThan != null and performanceAppraisalObjectsDTO.params.evaluationScoreLessThan.size() > 0">
            AND
            <foreach item="item"
                     collection="performanceAppraisalObjectsDTO.params.evaluationScoreLessThan"
                     index="index" open="(" separator="OR" close=")">
                pao.evaluation_score &lt; #{item}
            </foreach>
        </if>
        <if test="performanceAppraisalObjectsDTO.params.evaluationScoreNotLessThan != null and performanceAppraisalObjectsDTO.params.evaluationScoreNotLessThan.size() > 0">
            AND
            <foreach item="item"
                     collection="performanceAppraisalObjectsDTO.params.evaluationScoreNotLessThan"
                     index="index" open="(" separator="OR" close=")">
                pao.evaluation_score &gt;= #{item}
            </foreach>
        </if>
        ORDER BY
        pao.evaluation_score,
        pao.sort
    </select>
    <select id="selectOrgAppraisalObjectByObjectId"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceAppraisalObjectsDTO">
        SELECT
        pao.perform_appraisal_objects_id,
        pao.performance_appraisal_id,
        pao.appraisal_object_id,
        pao.appraisal_principal_id,
        IFNULL( pao.evaluation_score, 0.00 ) AS evaluation_score,
        pao.appraisal_result_id,
        pao.sort,
        pao.appraisal_object_status,
        pao.appraisal_principal_name,
        pao.create_by,
        pao.create_time,
        pao.update_by,
        pao.update_time,
        pa.appraisal_name,
        pa.appraisal_year,
        pa.cycle_type,
        pa.cycle_number,
        pa.appraisal_status,
        pas.appraisal_object_name,
        pas.appraisal_object_code,
        pas.department_id,
        pas.department_name,
        pas.post_id,
        pas.post_name,
        pas.official_rank_system_id,
        pas.official_rank,
        pas.official_rank_name,
        pao.appraisal_principal_name
        FROM
        performance_appraisal_objects pao
        LEFT JOIN perform_appraisal_object_snap pas ON pao.perform_appraisal_objects_id =
        pas.perform_appraisal_objects_id
        AND pas.delete_flag = 0
        LEFT JOIN performance_appraisal pa ON pa.performance_appraisal_id = pao.performance_appraisal_id
        AND pa.delete_flag = 0
        WHERE pao.delete_flag = 0
        AND pao.perform_appraisal_objects_id = #{performAppraisalObjectsId}
        ORDER BY
        pao.evaluation_score,
        pao.sort
    </select>
    <!--根据绩效等级ID集合查询绩效考核-->
    <select id="selectPerformanceAppraisalByRankIds"
            resultType="net.qixiaowei.operate.cloud.api.dto.performance.PerformanceAppraisalDTO">
        SELECT
        pa.performance_appraisal_id,
        pa.performance_rank_id,
        pa.performance_rank_name
        FROM performance_appraisal pa
        WHERE pa.delete_flag = 0
        AND pa.performance_rank_id
        IN
        <foreach collection="performanceRankIds" open="(" close=")" separator="," item="item" index="index">
            #{item}
        </foreach>
    </select>
    <!--新增绩效考核表-->
    <insert id="insertPerformanceAppraisal" useGeneratedKeys="true" keyProperty="performanceAppraisalId">
        INSERT INTO performance_appraisal
        (performance_rank_id,performance_rank_name,appraisal_year,appraisal_name,cycle_flag,cycle_type,cycle_number,appraisal_start_date,appraisal_end_date,filing_date,appraisal_flow,appraisal_object,self_defined_columns_flag,appraisal_status,delete_flag,create_by,create_time,update_by,update_time)
        VALUES
        (#{performanceAppraisal.performanceRankId},#{performanceAppraisal.performanceRankName},#{performanceAppraisal.appraisalYear},#{performanceAppraisal.appraisalName},#{performanceAppraisal.cycleFlag},#{performanceAppraisal.cycleType},#{performanceAppraisal.cycleNumber},#{performanceAppraisal.appraisalStartDate},#{performanceAppraisal.appraisalEndDate},#{performanceAppraisal.filingDate},#{performanceAppraisal.appraisalFlow},#{performanceAppraisal.appraisalObject},#{performanceAppraisal.selfDefinedColumnsFlag},#{performanceAppraisal.appraisalStatus},#{performanceAppraisal.deleteFlag},#{performanceAppraisal.createBy},#{performanceAppraisal.createTime},#{performanceAppraisal.updateBy},#{performanceAppraisal.updateTime})
    </insert>
    <!--修改绩效考核表-->
    <update id="updatePerformanceAppraisal">
        UPDATE performance_appraisal
        SET
        <if test="performanceAppraisal.performanceRankId != null">
            performance_rank_id=#{performanceAppraisal.performanceRankId},
        </if>
        <if test="performanceAppraisal.performanceRankName != null and performanceAppraisal.performanceRankName != ''">
            performance_rank_name=#{performanceAppraisal.performanceRankName},
        </if>
        <if test="performanceAppraisal.appraisalYear != null">
            appraisal_year=#{performanceAppraisal.appraisalYear},
        </if>
        <if test="performanceAppraisal.appraisalName != null and performanceAppraisal.appraisalName != ''">
            appraisal_name=#{performanceAppraisal.appraisalName},
        </if>
        <if test="performanceAppraisal.cycleFlag != null">
            cycle_flag=#{performanceAppraisal.cycleFlag},
        </if>
        <if test="performanceAppraisal.cycleType != null">
            cycle_type=#{performanceAppraisal.cycleType},
        </if>
        <if test="performanceAppraisal.cycleNumber != null">
            cycle_number=#{performanceAppraisal.cycleNumber},
        </if>
        <if test="performanceAppraisal.appraisalStartDate != null">
            appraisal_start_date=#{performanceAppraisal.appraisalStartDate},
        </if>
        <if test="performanceAppraisal.appraisalEndDate != null">
            appraisal_end_date=#{performanceAppraisal.appraisalEndDate},
        </if>
        <if test="performanceAppraisal.filingDate != null">
            filing_date=#{performanceAppraisal.filingDate},
        </if>
        <if test="performanceAppraisal.appraisalFlow != null">
            appraisal_flow=#{performanceAppraisal.appraisalFlow},
        </if>
        <if test="performanceAppraisal.appraisalObject != null">
            appraisal_object=#{performanceAppraisal.appraisalObject},
        </if>
        <if test="performanceAppraisal.selfDefinedColumnsFlag != null">
            self_defined_columns_flag=#{performanceAppraisal.selfDefinedColumnsFlag},
        </if>
        <if test="performanceAppraisal.appraisalStatus != null">
            appraisal_status=#{performanceAppraisal.appraisalStatus},
        </if>
        <if test="performanceAppraisal.deleteFlag != null">
            delete_flag=#{performanceAppraisal.deleteFlag},
        </if>
        <if test="performanceAppraisal.createBy != null">
            create_by=#{performanceAppraisal.createBy},
        </if>
        <if test="performanceAppraisal.createTime != null">
            create_time=#{performanceAppraisal.createTime},
        </if>
        <if test="performanceAppraisal.updateBy != null">
            update_by=#{performanceAppraisal.updateBy},
        </if>
        <if test="performanceAppraisal.updateTime != null">
            update_time=#{performanceAppraisal.updateTime}
        </if>
        WHERE
        performance_appraisal_id=#{performanceAppraisal.performanceAppraisalId}
    </update>
    <!--逻辑删除绩效考核表-->
    <update id="logicDeletePerformanceAppraisalByPerformanceAppraisalId">
        UPDATE performance_appraisal
        SET delete_flag= 1,
        update_by=#{performanceAppraisal.updateBy},
        update_time=#{performanceAppraisal.updateTime}
        WHERE
        performance_appraisal_id=#{performanceAppraisal.performanceAppraisalId}
    </update>
    <!--逻辑批量删除绩效考核表-->
    <update id="logicDeletePerformanceAppraisalByPerformanceAppraisalIds">
        UPDATE performance_appraisal
        SET delete_flag= 1,
        update_by=#{updateBy},
        update_time=#{updateTime}
        WHERE
        performance_appraisal_id IN
        <foreach item="item"
                 collection="performanceAppraisalIds"
                 index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
    <!--批量新增绩效考核表-->
    <insert id="batchPerformanceAppraisal">
        INSERT INTO performance_appraisal
        (performance_rank_id,performance_rank_name,appraisal_year,appraisal_name,cycle_flag,cycle_type,cycle_number,appraisal_start_date,appraisal_end_date,filing_date,appraisal_flow,appraisal_object,self_defined_columns_flag,appraisal_status,delete_flag,create_by,create_time,update_by,update_time)
        VALUES
        <foreach item="item" index="index"
                 collection="performanceAppraisals"
                 separator=",">
            (#{item.performanceRankId},#{item.performanceRankName},#{item.appraisalYear},#{item.appraisalName},#{item.cycleFlag},#{item.cycleType},#{item.cycleNumber},#{item.appraisalStartDate},#{item.appraisalEndDate},#{item.filingDate},#{item.appraisalFlow},#{item.appraisalObject},#{item.selfDefinedColumnsFlag},#{item.appraisalStatus},#{item.deleteFlag},#{item.createBy},#{item.createTime},#{item.updateBy},#{item.updateTime})
        </foreach>
    </insert>

    <!--物理删除绩效考核表-->
    <delete id="deletePerformanceAppraisalByPerformanceAppraisalId">
        DELETE FROM performance_appraisal
        WHERE performance_appraisal_id=#{performanceAppraisal}

    </delete>
    <!--物理批量删除绩效考核表-->
    <delete id="deletePerformanceAppraisalByPerformanceAppraisalIds">
        DELETE FROM performance_appraisal
        WHERE performance_appraisal_id IN
        <foreach item="item"
                 collection="performanceAppraisalIds"
                 index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </delete>
    <!--批量修改绩效考核表-->
    <update id="updatePerformanceAppraisals">
        update performance_appraisal
        <trim prefix="set" suffixOverrides=",">
            <trim prefix="performance_rank_id=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.performanceRankId != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.performanceRankId}
                    </if>
                </foreach>
            </trim>
            <trim prefix="performance_rank_name=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.performanceRankName != null and item.performanceRankName != ''">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.performanceRankName}
                    </if>
                </foreach>
            </trim>
            <trim prefix="appraisal_year=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.appraisalYear != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.appraisalYear}
                    </if>
                </foreach>
            </trim>
            <trim prefix="appraisal_name=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.appraisalName != null and item.appraisalName != ''">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.appraisalName}
                    </if>
                </foreach>
            </trim>
            <trim prefix="cycle_flag=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.cycleFlag != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.cycleFlag}
                    </if>
                </foreach>
            </trim>
            <trim prefix="cycle_type=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.cycleType != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.cycleType}
                    </if>
                </foreach>
            </trim>
            <trim prefix="cycle_number=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.cycleNumber != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.cycleNumber}
                    </if>
                </foreach>
            </trim>
            <trim prefix="appraisal_start_date=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.appraisalStartDate != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.appraisalStartDate}
                    </if>
                </foreach>
            </trim>
            <trim prefix="appraisal_end_date=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.appraisalEndDate != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.appraisalEndDate}
                    </if>
                </foreach>
            </trim>
            <trim prefix="filing_date=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.filingDate != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.filingDate}
                    </if>
                </foreach>
            </trim>
            <trim prefix="appraisal_flow=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.appraisalFlow != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.appraisalFlow}
                    </if>
                </foreach>
            </trim>
            <trim prefix="appraisal_object=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.appraisalObject != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.appraisalObject}
                    </if>
                </foreach>
            </trim>
            <trim prefix="self_defined_columns_flag=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.selfDefinedColumnsFlag != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.selfDefinedColumnsFlag}
                    </if>
                </foreach>
            </trim>
            <trim prefix="appraisal_status=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.appraisalStatus != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.appraisalStatus}
                    </if>
                </foreach>
            </trim>
            <trim prefix="delete_flag=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.deleteFlag != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.deleteFlag}
                    </if>
                </foreach>
            </trim>
            <trim prefix="create_by=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.createBy != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.createBy}
                    </if>
                </foreach>
            </trim>
            <trim prefix="create_time=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.createTime != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.createTime}
                    </if>
                </foreach>
            </trim>
            <trim prefix="update_by=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.updateBy != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.updateBy}
                    </if>
                </foreach>
            </trim>
            <trim prefix="update_time=case" suffix="end,">
                <foreach collection="performanceAppraisalList" item="item" index="index">
                    <if test="item.updateTime != null">
                        when performance_appraisal_id=#{item.performanceAppraisalId} then #{item.updateTime}
                    </if>
                </foreach>
            </trim>
        </trim>
        where
        <foreach collection="performanceAppraisalList" separator="or" item="item" index="index">
            performance_appraisal_id=#{item.performanceAppraisalId}
        </foreach>
    </update>
</mapper>


